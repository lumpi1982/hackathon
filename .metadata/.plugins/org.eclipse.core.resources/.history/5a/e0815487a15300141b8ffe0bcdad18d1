var express = require('express');
var app = express();
// This make a uri end point for the REST call
// http://myhost/emp will return the data
app.get('/users', function(req, res){
  console.log('Received request: username=', req.query['username']);
  fetchUsers(req,res);
  }
);

//var databaseUrl = "mongouser:Password1@localhost/mydb"; // "username:password@example.com/mydb"
//var collections = ["users", "reports"]
//var db = require("mongojs").connect(databaseUrl, collections);
var mongojs = require('mongojs');
var db = mongojs('mydb', ['users']);
 
// function registered in the /emp declaration
function fetchUsers(req,res){
	console.log("Starting search for users...");
	
	db.users.find({username: req.query['username']}, function(err, users) {
	  if( err || !users) console.log("No users found");
	  else users.forEach( function(user) {
	    console.log(user);
	    res.write(JSON.stringify(user));
	    res.end();
	  } );
	});

}
 
// listen on port 8000
app.listen(8000);
